<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Runenritual der Hexen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  padding:1rem;
  background:radial-gradient(circle at top,#1b1230 0%,#050308 75%);
  color:#eee;
  font-family:Georgia,serif;
}
h1{
  text-align:center;
  letter-spacing:.22em;
  margin:.2rem 0;
}
.sub{
  text-align:center;
  opacity:.7;
  font-size:.8rem;
  margin-bottom:1rem;
}

/* Drehr√§der-Layout */
.wheels{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:.7rem;
  margin-bottom:1.2rem;
}
.wheel-column{
  display:flex;
  flex-direction:column;
}
.label{
  text-align:center;
  font-size:.7rem;
  letter-spacing:.16em;
  opacity:.75;
  margin-bottom:.2rem;
}

/* Drehrad */
.wheel{
  border:1px solid #3a2a4a;
  border-radius:1rem;
  background:rgba(12,8,20,.85);
  padding:.3rem;
  height:220px;
  overflow-y:auto;
  scroll-snap-type:y mandatory;
  position:relative;
}
.spacer{
  height:80px;
}
.rune{
  scroll-snap-align:center;
  text-align:center;
  padding:.4rem 0;
  opacity:.35;
  transition:.25s ease;
}
.rune .symbol{
  font-size:2rem;
  line-height:1;
}
.rune .name{
  font-size:.6rem;
  opacity:.7;
  margin-top:.15rem;
}
.rune.active{
  opacity:1;
  transform:scale(1.15);
  text-shadow:0 0 14px rgba(200,160,255,.8);
}

/* Button & Ergebnis */
#cast{
  width:100%;
  padding:.9rem;
  font-size:1rem;
  background:linear-gradient(180deg,#3b2a5c,#1c122f);
  border:1px solid #6c55a3;
  border-radius:1rem;
}
#cast:active{
  transform:scale(.98);
}

/* NEU: Reset-Button */
#reset{
  width:100%;
  padding:.9rem;
  font-size:1rem;
  margin-top:.6rem;
  background:linear-gradient(180deg,#2a2a3c,#14141f);
  border:1px solid #6c55a3;
  border-radius:1rem;
}
#reset:active{
  transform:scale(.98);
}

#result{
  margin-top:1rem;
  padding:1.2rem;
  border:2px solid #5a3d88;
  border-radius:1rem;
  background:radial-gradient(circle at top,#140e22 0%,#07040b 70%);
  box-shadow:0 0 28px rgba(120,80,200,.6);
  line-height:1.6;
  opacity:0;
  transform:translateY(8px);
  transition:.6s ease;
}
#result.show{
  opacity:1;
  transform:none;
}
hr{
  border:none;
  border-top:1px solid #34234f;
  margin:.8rem 0;
}
.small{
  opacity:.7;
  font-size:.75rem;
}

/* ===== ZENTRIER-MARKER (RITUAL-FOKUS) ===== */

/* Fokuslinie */
.wheel::after{
  content:"";
  position:absolute;
  top:50%;
  left:6%;
  right:6%;
  height:2px;
  transform:translateY(-50%);
  background:linear-gradient(
    90deg,
    transparent,
    rgba(190,160,255,.95),
    transparent
  );
  box-shadow:
    0 0 10px rgba(190,160,255,.8),
    0 0 22px rgba(120,80,200,.6);
  pointer-events:none;
  z-index:5;
}

/* Fokusfeld (sanfter Nebel um die Linie) */
.wheel::before{
  content:"";
  position:absolute;
  top:50%;
  left:0;
  right:0;
  height:46px;
  transform:translateY(-50%);
  background:radial-gradient(
    ellipse at center,
    rgba(160,120,220,.18) 0%,
    rgba(160,120,220,.08) 35%,
    transparent 70%
  );
  pointer-events:none;
  z-index:4;
}

/* ===== MANIFESTATIONS-PHASE ===== */

/* R√§der treten zur√ºck */
body.manifest .wheel{
  filter:grayscale(.6) brightness(.75);
}

/* Ergebnis erscheint ‚Äûbeschworen‚Äú */
#result{
  position:relative;
}
#result::before{
  content:"";
  position:absolute;
  inset:-8px;
  border-radius:1.2rem;
  background:radial-gradient(
    circle at top,
    rgba(180,140,255,.35),
    transparent 70%
  );
  opacity:0;
  transition:.6s ease;
  pointer-events:none;
}
#result.show::before{
  opacity:1;
}
</style>
</head>

<body>
<h1>RUNENRITUAL</h1>
<div class="sub">Drehe die Zeichen ¬∑ 1√ó pro Long Rest</div>

<div class="wheels">
  <div class="wheel-column">
    <div class="label">ANKER</div>
    <div class="wheel" id="anker"></div>
  </div>
  <div class="wheel-column">
    <div class="label">EID</div>
    <div class="wheel" id="eid"></div>
  </div>
  <div class="wheel-column">
    <div class="label">FLUSS</div>
    <div class="wheel" id="fluss"></div>
  </div>
</div>

<button id="cast">üîÆ RITUAL WIRKEN</button>
<button id="reset">üåô LONG REST</button>

<div id="result">
  <span class="small">Drehe die R√§der, bis sich eine Kombination richtig anf√ºhlt.</span>
</div>

<script>
/* ===== RUNENZEICHEN ===== */
const RUNES = {
  Fehu:"·ö†", Uruz:"·ö¢", Thurisaz:"·ö¶", Ansuz:"·ö®",
  Raidho:"·ö±", Kenaz:"·ö≤", Gebo:"·ö∑", Wunjo:"·öπ",
  Berkano:"·õí", Tiwaz:"·õè", Algiz:"·õâ", Dagaz:"·õû",
  Ingwaz:"·õú", Laguz:"·õö", Mannaz:"·õó", Othala:"·õü",
  Sowilo:"·õä", Jera:"·õÉ", Isa:"·õÅ", Hagalaz:"·ö∫",
  Perthro:"·õà", Nauthiz:"·öæ", Eihwaz:"·õá"
};

/* ===== OMEN PRO ANKER ===== */
const OMEN = {
  Fehu:"Fehu tritt hervor ‚Äì Besitz verlangt F√ºhrung.",
  Uruz:"Uruz zeigt sich ‚Äì dein K√∂rper tr√§gt heute mehr.",
  Thurisaz:"Thurisaz blockiert den Weg ‚Äì Macht kommt durch Widerstand.",
  Ansuz:"Ansuz fl√ºstert ‚Äì Worte und Zauber h√∂ren zu.",
  Raidho:"Raidho rollt ‚Äì Bewegung formt das Schicksal.",
  Kenaz:"Kenaz brennt ‚Äì Wahrheit duldet keinen Schatten.",
  Gebo:"Gebo fordert Austausch ‚Äì nichts bleibt einseitig.",
  Wunjo:"Wunjo l√§chelt vorsichtig ‚Äì der Geist sucht Balance."
};

/* ===== 64 EFFEKTE (ANKER √ó EID) ===== */
const EFFECTS = {
  Fehu:{
    Berkano:"Erhalte 1d4 zus√§tzliche Ladungen f√ºr ein begrenztes Item.",
    Tiwaz:"Gold- oder Ressourcenaufwand z√§hlt einmalig als doppelt effektiv.",
    Algiz:"Ein Besitz kann einmal nicht gestohlen oder zerst√∂rt werden.",
    Dagaz:"Ein Handel oder Tausch gelingt automatisch.",
    Ingwaz:"Speichere einen Ressourcenbonus (bis 50 gp √Ñquivalent).",
    Laguz:"Nach Ressourcenverlust darfst du ihn einmal r√ºckg√§ngig machen.",
    Mannaz:"Advantage bei Checks mit wertvollen Gegenst√§nden.",
    Othala:"Ein Item ist bis zum n√§chsten Long Rest fest an dich gebunden."
  },
  Uruz:{
    Berkano:"Erhalte tempor√§re Trefferpunkte (1d6 + Proficiency Bonus).",
    Tiwaz:"+1d4 Schaden bei STR-basierten Angriffen (1√ó pro Runde).",
    Algiz:"Einmal pro Runde Resistance gegen physischen Schaden.",
    Dagaz:"Ein STR- oder CON-Rettungswurf gilt automatisch als bestanden.",
    Ingwaz:"Speichere +1d8 f√ºr einen k√∂rperlichen Wurf.",
    Laguz:"Nach einem Miss darfst du +1d4 hinzuf√ºgen.",
    Mannaz:"Advantage auf Athletics oder Acrobatics.",
    Othala:"Du kannst einmal nicht prone werden."
  },
  Thurisaz:{
    Berkano:"Dein erster Treffer verursacht +1d6 zus√§tzlichen Schaden.",
    Tiwaz:"+1 auf Attack Rolls (1√ó pro Runde).",
    Algiz:"Ignoriere einmal Shield oder √§hnliche parierende Effekte.",
    Dagaz:"Ein Angriff trifft automatisch (kein erzwungener Krit).",
    Ingwaz:"Speichere +1d10 zus√§tzlichen Schaden.",
    Laguz:"Nach einem verfehlten Angriff darfst du den Wurf wiederholen.",
    Mannaz:"Advantage auf Angriffe gegen ein ausgew√§hltes Ziel.",
    Othala:"Deine Waffe z√§hlt als magisch gegen Resistenz/Immunit√§t."
  },
  Ansuz:{
    Berkano:"Nach Wirken eines Zaubers erh√§ltst du Temp-TP = Zaubergrad √ó 2.",
    Tiwaz:"+1 auf Spell Attack oder Spell Save DC (f√ºr 1 Zauber).",
    Algiz:"Advantage auf Concentration Saves.",
    Dagaz:"Ein Zauber ignoriert Disadvantage.",
    Ingwaz:"Speichere einen +1-Zaubergrad-Effekt (z. B. extra Schaden/Ziele).",
    Laguz:"Nach Zauber-Fehlschlag +1d4 auf den n√§chsten Spell Attack.",
    Mannaz:"Advantage auf Arcana oder Religion.",
    Othala:"Ein Zauber ist an einen Ort oder ein Objekt gebunden."
  },
  Raidho:{
    Berkano:"Erhalte einen Bewegungs-Puffer von +10 ft.",
    Tiwaz:"+10 ft Bewegung, wenn du in deinem Zug angreifst.",
    Algiz:"Ignoriere Difficult Terrain.",
    Dagaz:"Du handelst in der n√§chsten Runde automatisch zuerst.",
    Ingwaz:"Speichere einen 10-ft-Teleport (Bonus Action).",
    Laguz:"Nach einer Opportunity Attack verliert der Gegner seine Reaktion.",
    Mannaz:"Advantage auf Initiative.",
    Othala:"Du kannst einmal nicht bewegt oder verschoben werden."
  },
  Kenaz:{
    Berkano:"+1d4 Bonus auf den n√§chsten Wahrnehmungs- oder Erkenntniswurf.",
    Tiwaz:"+1 auf Perception oder Investigation.",
    Algiz:"Advantage auf Checks gegen Illusionen.",
    Dagaz:"Du erh√§ltst automatisch einen wichtigen Hinweis der SL.",
    Ingwaz:"Speichere +1d8 f√ºr einen Erkenntniswurf.",
    Laguz:"Nach Fehlschlag darfst du einen Wahrnehmungswurf wiederholen.",
    Mannaz:"Advantage auf Insight.",
    Othala:"Ein Ort bleibt f√ºr dich immer erkennbar und leicht auffindbar."
  },
  Gebo:{
    Berkano:"Erhalte einen sozialen Gunst-Token (kleiner Gefallen, SL legt fest).",
    Tiwaz:"+1 auf CHA-basierte Checks.",
    Algiz:"Du bist einmalig immun gegen Charm-Effekte.",
    Dagaz:"Eine Bitte wird automatisch akzeptiert (im Rahmen des M√∂glichen).",
    Ingwaz:"Speichere Advantage f√ºr einen sp√§teren sozialen Wurf.",
    Laguz:"Nach Ablehnung darfst du einmal einen zweiten Versuch starten.",
    Mannaz:"Advantage auf Persuasion oder Deception.",
    Othala:"Ein NPC h√§lt dir gegen√ºber sicher sein Wort."
  },
  Wunjo:{
    Berkano:"Erhalte tempor√§re TP, die nur bei psychischem Schaden verbraucht werden.",
    Tiwaz:"+1 auf Rettungsw√ºrfe.",
    Algiz:"Resistance gegen Fear oder Charm.",
    Dagaz:"Ein WIS- oder CHA-Save gilt automatisch als bestanden.",
    Ingwaz:"Speichere +1d10 Bonus auf einen Save.",
    Laguz:"Nach einem misslungenen Save darfst du den Wurf wiederholen.",
    Mannaz:"Advantage auf WIS- oder CHA-Saves.",
    Othala:"Du kannst einmal nicht frightened werden."
  }
};

/* ===== FLUSS-RUNEN ===== */
const FLUSS = {
  Sowilo:{
    dur:"Bis zum n√§chsten Long Rest",
    price:"Kein zus√§tzlicher Preis."
  },
  Jera:{
    dur:"24 Stunden (verz√∂gert wirksam)",
    price:"Der Effekt kann nicht vorzeitig beendet werden."
  },
  Isa:{
    dur:"1 Encounter",
    price:"Deine Bewegung ist halbiert oder deine Bonusaktion blockiert."
  },
  Hagalaz:{
    dur:"1 Encounter",
    price:"Du erleidest 1d6 Schaden beim Wirken des Rituals."
  },
  Perthro:{
    dur:"Bis ein passender Trigger eintritt",
    price:"Tritt kein Trigger ein, verursacht die Magie eine kleine Fehlwirkung."
  },
  Nauthiz:{
    dur:"Bis zum n√§chsten Long Rest",
    price:"Du erleidest 1 Stufe Ersch√∂pfung."
  },
  Eihwaz:{
    dur:"Bis eine klare Schwelle erreicht ist",
    price:"Nach Ausl√∂sung hast du Nachteil auf deinen n√§chsten Wurf."
  },
  Algiz:{
    dur:"Bis zum n√§chsten Long Rest",
    price:"Der Effekt ist leicht abgeschw√§cht, aber vor Gegenmagie gesch√ºtzt."
  }
};

let pick = { anker:null, eid:null, fluss:null };

/* ===== DREHRAD MIT 5√ó WIEDERHOLUNG ===== */
function buildWheel(id, keys, storeKey){
  const el = document.getElementById(id);
  const repeat = 5;         // 5 Bl√∂cke hintereinander
  const centerIndex = 2;    // mittlerer Block (0‚Äì4)
  const runes = [];

  // oberer Spacer
  const top = document.createElement("div");
  top.className = "spacer";
  el.appendChild(top);

  // mehrfach Runen einf√ºgen
  for(let i=0;i<repeat;i++){
    keys.forEach(name=>{
      const d = document.createElement("div");
      d.className = "rune";
      d.dataset.value = name;
      d.innerHTML = `
        <div class="symbol">${RUNES[name]}</div>
        <div class="name">${name}</div>
      `;
      el.appendChild(d);
      runes.push(d);
    });
  }

  // unterer Spacer
  const bottom = document.createElement("div");
  bottom.className = "spacer";
  el.appendChild(bottom);

  // Start: mittlerer Block
  requestAnimationFrame(()=>{
    if(!runes.length) return;
    const runeHeight = runes[0].offsetHeight || 1;
    const block = runeHeight * keys.length;
    el.scrollTop = block * centerIndex;

    // Initial aktive Rune bestimmen
    const rect = el.getBoundingClientRect();
    let best = null;
    let bestDist = Infinity;
    runes.forEach(node=>{
      const r = node.getBoundingClientRect();
      const d = Math.abs((r.top + r.height/2) - (rect.top + rect.height/2));
      if(d < bestDist){ bestDist = d; best = node; }
    });
    if(best){
      runes.forEach(n=>n.classList.remove("active"));
      best.classList.add("active");
      pick[storeKey] = best.dataset.value;
    }
  });

  // Scroll-Logik
  el.addEventListener("scroll",()=>{
    if(!runes.length) return;
    const runeHeight = runes[0].offsetHeight || 1;
    const block = runeHeight * keys.length;

    // erst springen wenn man den mittleren Bereich wirklich verl√§sst:
    // nach ca. 2 Bl√∂cken nach oben/unten
    const lowerThreshold = block * (centerIndex - 1.5); // 0.5 Block
    const upperThreshold = block * (centerIndex + 1.5); // 3.5 Block

    if(el.scrollTop < lowerThreshold){
      el.scrollTop += block * 2;
    } else if(el.scrollTop > upperThreshold){
      el.scrollTop -= block * 2;
    }

    const rect = el.getBoundingClientRect();
    let best = null;
    let bestDist = Infinity;
    runes.forEach(node=>{
      const r = node.getBoundingClientRect();
      const d = Math.abs((r.top + r.height/2) - (rect.top + rect.height/2));
      if(d < bestDist){
        bestDist = d;
        best = node;
      }
    });

    if(best){
      runes.forEach(n=>n.classList.remove("active"));
      best.classList.add("active");
      pick[storeKey] = best.dataset.value;
    }
  });
}

/* ===== R√ÑDER AUFBAUEN ===== */
buildWheel("anker", Object.keys(OMEN), "anker");
buildWheel("eid", Object.keys(EFFECTS.Fehu), "eid");
buildWheel("fluss", Object.keys(FLUSS), "fluss");

/* ===== RITUAL WIRKEN ===== */
document.getElementById("cast").onclick = () => {
  document.body.classList.add("manifest"); // Manifestations-Phase aktiv

  if(!pick.anker || !pick.eid || !pick.fluss) return;

  const omen  = OMEN[pick.anker];
  const effect = EFFECTS[pick.anker][pick.eid];
  const flow  = FLUSS[pick.fluss];

  const res = document.getElementById("result");
  res.innerHTML = `
    <b>üïØÔ∏è OMEN</b><br><i>${omen}</i>
    <hr>
    <b>‚öîÔ∏è EFFEKT</b><br>
    ${effect}<br>
    <b>Dauer:</b> ${flow.dur}
    <hr>
    <b>‚ö†Ô∏è PREIS</b><br>
    ${flow.price}
    <hr>
    <span class="small">
      Runenritual: 1√ó pro Long Rest ¬∑ Effekte stapeln nicht mit sich selbst.
    </span>
  `;
  res.classList.add("show");
};

/* ===== LONG REST / RESET ===== */
document.getElementById("reset").onclick = () => {
  document.body.classList.remove("manifest");
  const res = document.getElementById("result");
  res.classList.remove("show");
  res.innerHTML = `
    <span class="small">
      Ein neuer Tag bricht an. Die Runen schweigen.
    </span>
  `;
};
</script>
</body>
</html>